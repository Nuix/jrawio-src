<?xml version="1.0" encoding="UTF-8"?>

<project name="publish" default="jar" basedir=".">

    <!-- =======================================================================

    

    ======================================================================== -->
    <target name="publish-release" depends="distribution">
        <javaNetUpload projectName="${java.net.projectName}"
                       toFile="${tag}/${java.net.projectName}-${tag}-src.zip"
                       fromFile="dist/${java.net.projectName}-${tag}-src.zip"
                       fileDescription="Source files"
                       fileStatus="Stable"/>
        <javaNetUpload projectName="mistral"
                       toFile="${tag}/${java.net.projectName}-${tag}-bin.zip"
                       fromFile="dist/${java.net.projectName}-${tag}-bin.zip"
                       fileDescription="Binary distribution"
                       fileStatus="Stable"/>
    </target>

    <!-- =======================================================================

    

    ======================================================================== -->
    <target name="publish-snapshot" depends="distribution">
        <javaNetUpload projectName="${java.net.projectName}"
                       toFile="Nightly builds/Sources/${java.net.projectName}-${tag}-src.zip"
                       fromFile="dist/${java.net.projectName}-${tag}-src.zip"
                       fileDescription="Source files"
                       fileStatus="Draft"/>
        <javaNetUpload projectName="${java.net.projectName}"
                       toFile="Nightly builds/Binaries/${java.net.projectName}-${tag}-bin.zip"
                       fromFile="dist/${java.net.projectName}-${tag}-bin.zip"
                       fileDescription="Binary distribution"
                       fileStatus="Draft"/>
    </target>

    <!-- =======================================================================

    

    ======================================================================== -->
    <target name="distribution" depends="clean, gettag, jar, javadoc, src-zip, bin-zip"/>

    <!-- =======================================================================

    

    ======================================================================== -->
    <target name="src-zip" depends="gettag">
	<mkdir dir="dist"/>
	<delete file="dist/${java.net.projectName}-${tag}-src.zip" failonerror="false"/>
	<zip destfile="dist/${java.net.projectName}-${tag}-src.zip" basedir="." excludes="**/.svn/**,**/build/**,**/dist/**,**/nbproject/private/**,dist/**,Rio*/**, **/image.properties*">
        </zip>
    </target>

    <!-- =======================================================================

    

    ======================================================================== -->
    <target name="bin-zip" depends="gettag">
	<mkdir dir="dist"/>
	<delete file="dist/${java.net.projectName}-${tag}-bin.zip" failonerror="false"/>
	<zip destfile="dist/${java.net.projectName}-${tag}-bin.zip" basedir="." excludes="**/.svn/**,**/src/**,**/build/**,**/nbproject/**,**/test/**,**/build.xml,dist/**,lib/**,Rio*/**, **/image.properties*, tools/** ">
        </zip>
    </target>

    <!-- =======================================================================

    Retrieves the current revision number from the subversion facility.

    ======================================================================== -->
    <target name="gettag">
        <delete failonerror="false" file="subversion1.properties" />
        <delete failonerror="false" file="subversion2.properties" />
        <exec executable="svn" output="subversion1.properties">
            <arg line="info -r HEAD"/>
        </exec>
        <exec executable="svn" output="subversion2.properties">
            <arg line="info -r HEAD tools"/>
        </exec>
        <property prefix="subversion1" file="subversion1.properties"/>
        <property prefix="subversion2" file="subversion2.properties"/>
        <delete file="subversion1.properties" />
        <delete file="subversion2.properties" />

        <property prefix="release" file="RELEASE"/>
        <property name="tag" value="${release.Release}-${subversion1.Revision}-${subversion2.Revision}"/>
        <echo message="Current build is ${tag}..." />
    </target>
</project>
